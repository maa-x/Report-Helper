package com.pentest.reporthelper.ui.component;

import javax.swing.GroupLayout;
import javax.swing.JButton;
import javax.swing.JCheckBoxMenuItem;
import javax.swing.JPopupMenu;
import javax.swing.JToolBar;
import javax.swing.Timer;
import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;
import javax.swing.JTextField;
import java.awt.Color;
import java.awt.event.FocusEvent;
import java.awt.event.FocusListener;

public class SearchToolbarPanel extends JToolBar {
    public SearchToolbarPanel(ReportHelperComponent parent) {
        // setLayout(new FlowLayout(FlowLayout.LEFT));
        setFloatable(false);

       JTextField searchText = new JTextField("Search");
        searchText.setForeground(Color.GRAY);
        searchText.addFocusListener(new FocusListener() {
            @Override
            public void focusGained(FocusEvent e) {
                if (searchText.getText().equals("Search")) {
                    searchText.setText("");
                    searchText.setForeground(Color.BLACK);
                }
            }
        
            @Override
            public void focusLost(FocusEvent e) {
                if (searchText.getText().isEmpty()) {
                    searchText.setForeground(Color.GRAY);
                    searchText.setText("Search");
                }
            }
        });
        
        JButton gearButton = new JButton("âš™");
        JPopupMenu settingsMenu = new JPopupMenu();
        JCheckBoxMenuItem regexCheckBox = new JCheckBoxMenuItem("Regex");
        JCheckBoxMenuItem caseCheckBox = new JCheckBoxMenuItem("Match Case");
        JCheckBoxMenuItem highlightAllCheckBox = new JCheckBoxMenuItem("Highlight All");
        highlightAllCheckBox.setSelected(true);
        settingsMenu.add(regexCheckBox);
        settingsMenu.add(caseCheckBox);
        settingsMenu.add(highlightAllCheckBox);
        
        gearButton.addActionListener(e -> settingsMenu.show(gearButton, gearButton.getWidth(), gearButton.getHeight()));
        
        JButton searchForwardButton = new JButton("ðŸ¡†");
        JButton searchBackwardButton = new JButton("ðŸ¡„");

        searchForwardButton.addActionListener(e -> parent.searchText(searchText.getText(), regexCheckBox.isSelected(), caseCheckBox.isSelected(), true, highlightAllCheckBox.isSelected()));
        searchBackwardButton.addActionListener(e -> parent.searchText(searchText.getText(), regexCheckBox.isSelected(), caseCheckBox.isSelected(), false,  highlightAllCheckBox.isSelected()));
        highlightAllCheckBox.addActionListener(e -> parent.searchText(searchText.getText(), regexCheckBox.isSelected(), caseCheckBox.isSelected(), false, highlightAllCheckBox.isSelected()));
        
        Timer searchTimer = new Timer(500, e -> {
            String text = searchText.getText();
            if (text.length() > 2) {
                parent.searchText(text, regexCheckBox.isSelected(), caseCheckBox.isSelected(), true, highlightAllCheckBox.isSelected());
            }
        });
        searchTimer.setRepeats(false);
        
        searchText.getDocument().addDocumentListener(new DocumentListener() {
            @Override
            public void insertUpdate(DocumentEvent e) {
                searchTimer.restart();
            }
        
            @Override
            public void removeUpdate(DocumentEvent e) {
                searchTimer.restart();
            }
        
            @Override
            public void changedUpdate(DocumentEvent e) {
                searchTimer.restart();
            }
        });

        GroupLayout layout = new GroupLayout(this);
        this.setLayout(layout);
        
        layout.setAutoCreateGaps(true);
        layout.setAutoCreateContainerGaps(true);
        
        layout.setHorizontalGroup(
            layout.createSequentialGroup()
                .addComponent(searchBackwardButton)
                .addComponent(searchForwardButton)
                .addComponent(searchText, GroupLayout.DEFAULT_SIZE, GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(gearButton)
        );
        
        layout.setVerticalGroup(
            layout.createParallelGroup(GroupLayout.Alignment.BASELINE)
                .addComponent(searchBackwardButton)
                .addComponent(searchForwardButton)
                .addComponent(searchText)
                .addComponent(gearButton)
        );
        
       
    }
}